:80 {
  # API reverse proxy — route all API calls through Traefik
  # Traefik handles service discovery via Coolify labels, so container
  # hostname changes on redeploy don't break routing.
  # Host header set to the bare IP so Traefik's PathPrefix rules match.
  handle /api/v1/* {
    reverse_proxy 213.32.19.116:80 {
      header_up Host 213.32.19.116
    }
  }

  # Static files — PWA app shell (fallback for everything else)
  handle {
    root * /srv
    try_files {path} /index.html
    file_server
    encode gzip
    header /.well-known/assetlinks.json Content-Type application/json
    # Prevent caching HTML and service worker files so updates are picked up immediately
    @html path *.html /
    header @html Cache-Control "no-cache, no-store, must-revalidate"
    @sw path /sw.js /sw-register.js
    header @sw Cache-Control "no-cache, no-store, must-revalidate"
  }
}
