appId: com.agrischeme.pro
---
# Eligibility E2E tests
# Tests: navigate to list, stats, scheme cards, detail view, check eligibility, back nav
# Total: 7 test assertions
#
# NOTE: Uses text selectors because testID/id selectors are NOT exposed in TWA Chrome Custom Tab
# NOTE: Inline login because Chrome may restore the eligibility URL from a previous run

# ============================================================
# Login (inline - tolerates landing on eligibility page)
# ============================================================
- launchApp:
    clearState: true

# Wait for any screen to load
- extendedWaitUntil:
    visible: "AgriScheme Pro|ðŸ””|Welcome back|Eligibility"
    timeout: 20000

# If login screen is showing, perform login
- runFlow:
    when:
      visible: "+254"
    commands:
      - tapOn: "+254"
      - eraseText: 20
      - inputText: "+254799999999"
      - hideKeyboard
      - tapOn:
          point: 50%, 58%
      - eraseText: 10
      - inputText: "1234"
      - hideKeyboard
      - tapOn: "Login"

# Wait for post-login content (home or eligibility page)
- extendedWaitUntil:
    visible: "ðŸ””|Available Schemes|Available Programs"
    timeout: 20000

# If we landed on the eligibility page, go back to home
- runFlow:
    when:
      visible: "Available Programs"
    commands:
      - pressKey: back
      - extendedWaitUntil:
          visible: "ðŸ””"
          timeout: 10000

# ============================================================
# Test 1: Navigate to eligibility from home
# ============================================================
- scrollUntilVisible:
    element: "Scheme Eligibility Criteria"
    direction: DOWN
    timeout: 10000

- tapOn: "Check Eligibility"

- extendedWaitUntil:
    visible: "Available Programs"
    timeout: 10000
- takeScreenshot: "elig_01_navigate_from_home"

# ============================================================
# Test 2: Display eligibility list with stats
# ============================================================
- assertVisible: "Available Schemes"
- takeScreenshot: "elig_02_list_stats"

# ============================================================
# Test 3: Display scheme cards
# ============================================================
- scrollUntilVisible:
    element: "Agricultural Input Subsidy"
    direction: DOWN
    timeout: 10000
- assertVisible: "Agricultural Input Subsidy"
- takeScreenshot: "elig_03_scheme_cards"

# ============================================================
# Test 4: Navigate to scheme detail
# ============================================================
- tapOn: "Agricultural Input Subsidy"
- extendedWaitUntil:
    visible: "Benefit Type"
    timeout: 10000
- waitForAnimationToEnd
- assertVisible: "Agricultural Input Subsidy"
- takeScreenshot: "elig_04_scheme_detail"

# ============================================================
# Test 5: Check eligibility button visible on detail
# ============================================================
- scrollUntilVisible:
    element: "Check My Eligibility"
    direction: DOWN
    timeout: 10000
- assertVisible: "Check My Eligibility"
- takeScreenshot: "elig_05_check_button"

# ============================================================
# Test 6: Navigate back to list
# ============================================================
- scrollUntilVisible:
    element: "Back"
    direction: UP
    timeout: 10000
- tapOn: "Back"
- waitForAnimationToEnd
- extendedWaitUntil:
    visible: "Available Programs"
    timeout: 10000
- takeScreenshot: "elig_06_back_to_list"

# ============================================================
# Test 7: Navigate back to home
# ============================================================
- pressKey: back
- extendedWaitUntil:
    visible: "ðŸ””"
    timeout: 10000
- assertVisible: "ðŸ””"
- takeScreenshot: "elig_07_back_to_home"
