# Eligibility E2E Test Flow
# Tests the eligibility assessment feature using unique testIDs

appId: com.agrischeme.pro
name: Eligibility Flow
tags:
  - eligibility
  - e2e

---

# ===== PHASE 1: LOGIN =====
- launchApp:
    clearState: true

- waitForAnimationToEnd

# Handle already logged in state - logout first if needed
- runFlow:
    when:
      visible:
        id: "home-greeting"
    commands:
      # Navigate to profile tab using testID
      - tapOn:
          id: "tab-profile"
      - waitForAnimationToEnd
      # Scroll to find logout button
      - swipe:
          start: "50%,80%"
          end: "50%,20%"
      - waitForAnimationToEnd
      # Tap logout using new testID
      - tapOn:
          id: "profile-logout-button"
      - waitForAnimationToEnd

# Wait for login screen using new testID
- extendedWaitUntil:
    visible:
      id: "login-subtitle"
    timeout: 15000

# Enter credentials using unique testIDs
- tapOn:
    id: "login-email-input"
- inputText: "demo@agripro.com"

- tapOn:
    id: "login-password-input"
- inputText: "Demo1234X"

- tapOn:
    id: "login-submit-button"

# Wait for home screen using new testID
- extendedWaitUntil:
    visible:
      id: "home-greeting"
    timeout: 15000

# ===== PHASE 2: VERIFY HOME SCREEN =====
# Verify key elements using testIDs
- assertVisible:
    id: "home-screen"
- assertVisible:
    id: "home-stats-container"
- assertVisible:
    id: "home-eligibility-card"

# ===== PHASE 3: NAVIGATE TO ELIGIBILITY =====
# Scroll to ensure eligibility card is visible
- swipe:
    start: "50%,70%"
    end: "50%,40%"
- waitForAnimationToEnd

# Tap on eligibility card using new testID
- tapOn:
    id: "home-eligibility-card"
- waitForAnimationToEnd

# ===== PHASE 4: VERIFY ELIGIBILITY LIST SCREEN =====
- extendedWaitUntil:
    visible:
      id: "eligibility-list-screen"
    timeout: 10000

- assertVisible:
    id: "eligibility-list-title"
- assertVisible:
    id: "eligibility-list-stats"
- assertVisible:
    id: "eligibility-list-stat-available"
- assertVisible:
    id: "eligibility-list-stat-enrolled"
- assertVisible:
    id: "eligibility-list-stat-pending"
- assertVisible:
    id: "eligibility-list-section-title"

# ===== PHASE 5: VIEW SCHEME DETAILS =====
# Tap on first scheme card using new testID
- tapOn:
    id: "eligibility-list-scheme-card-1"
- waitForAnimationToEnd

# Verify scheme detail screen using testIDs
- extendedWaitUntil:
    visible:
      id: "eligibility-detail-screen"
    timeout: 10000

- assertVisible:
    id: "eligibility-detail-name"
- assertVisible:
    id: "eligibility-detail-type-tag"
- assertVisible:
    id: "eligibility-detail-info-card"
- assertVisible:
    id: "eligibility-detail-benefit-type"
- assertVisible:
    id: "eligibility-detail-benefit-amount"
- assertVisible:
    id: "eligibility-detail-deadline"

# ===== PHASE 6: CHECK ELIGIBILITY =====
# Tap Check Eligibility button using new testID
- tapOn:
    id: "eligibility-detail-check-button"

# Wait for assessment to complete (2 second delay in mock)
- extendedWaitUntil:
    visible:
      id: "eligibility-detail-assessment"
    timeout: 10000

# Verify assessment results using testIDs
- assertVisible:
    id: "eligibility-detail-assessment-title"
- assertVisible:
    id: "eligibility-detail-score-card"
- assertVisible:
    id: "eligibility-detail-score-value"
- assertVisible:
    id: "eligibility-detail-risk-card"
- assertVisible:
    id: "eligibility-detail-risk-value"
- assertVisible:
    id: "eligibility-detail-status-badge"

# ===== PHASE 7: VERIFY RULE RESULTS =====
# Scroll to see eligibility criteria
- swipe:
    start: "50%,80%"
    end: "50%,30%"
- waitForAnimationToEnd

- assertVisible:
    id: "eligibility-detail-rules-summary"
- assertVisible:
    id: "eligibility-detail-rules-title"

# Verify at least one rule is visible
- assertVisible:
    id: "eligibility-detail-rule-1"

# ===== PHASE 8: NAVIGATE BACK =====
# Scroll back to top
- swipe:
    start: "50%,30%"
    end: "50%,80%"
- swipe:
    start: "50%,30%"
    end: "50%,80%"
- waitForAnimationToEnd

# Tap back button using new testID
- tapOn:
    id: "eligibility-detail-back-button"
- waitForAnimationToEnd

# Verify we're back on the eligibility list
- extendedWaitUntil:
    visible:
      id: "eligibility-list-screen"
    timeout: 5000

- assertVisible:
    id: "eligibility-list-title"

# ===== PHASE 9: RETURN TO HOME =====
# Navigate back to home using back button
- tapOn:
    id: "eligibility-list-back-button"
- waitForAnimationToEnd

# Verify we're on home screen
- extendedWaitUntil:
    visible:
      id: "home-screen"
    timeout: 5000

# Scroll to top to ensure greeting is visible
- swipe:
    start: "50%,30%"
    end: "50%,80%"
- waitForAnimationToEnd

- assertVisible:
    id: "home-greeting"

# ===== TEST COMPLETE =====
# Successfully tested using unique testIDs:
# - Login with credentials (login-email-input, login-password-input, login-submit-button)
# - Home screen elements (home-screen, home-greeting, home-eligibility-card)
# - Eligibility list (eligibility-list-screen, eligibility-list-title, eligibility-list-stats)
# - Scheme details (eligibility-detail-screen, eligibility-detail-name, eligibility-detail-check-button)
# - Assessment results (eligibility-detail-assessment, eligibility-detail-score-value, eligibility-detail-rule-*)
# - Navigation (eligibility-detail-back-button, profile-logout-button)
