# Eligibility E2E Test Flow
# Tests the eligibility assessment feature

appId: com.agrischeme.pro
name: Eligibility Flow
tags:
  - eligibility
  - e2e

---

# ===== PHASE 1: LOGIN =====
- launchApp:
    clearState: true

- waitForAnimationToEnd

# Handle already logged in state - logout first if needed
- runFlow:
    when:
      visible: "Welcome back!"
    commands:
      - tapOn:
          point: "85%,94%"
      - waitForAnimationToEnd
      - swipe:
          start: "50%,80%"
          end: "50%,20%"
      - waitForAnimationToEnd
      - tapOn:
          id: "logout-button"
      - waitForAnimationToEnd

# Login with demo account
- extendedWaitUntil:
    visible: "Farm Management System"
    timeout: 15000

- tapOn:
    id: "email-input"
- inputText: "demo@agripro.com"

- tapOn:
    id: "password-input"
- inputText: "Demo1234X"

- tapOn: "Login"

- extendedWaitUntil:
    visible: "Welcome back!"
    timeout: 15000

# ===== PHASE 2: NAVIGATE TO ELIGIBILITY =====
# Wait for home screen to fully load
- extendedWaitUntil:
    visible: "Scheme Eligibility"
    timeout: 10000

# Scroll down to ensure eligibility card is visible
- swipe:
    start: "50%,70%"
    end: "50%,40%"
- waitForAnimationToEnd

# Tap on eligibility card using testID
- tapOn:
    id: "eligibility-card"

- waitForAnimationToEnd

# ===== PHASE 3: VERIFY ELIGIBILITY LIST SCREEN =====
- assertVisible: "Eligibility & Schemes"
- assertVisible: "Available Programs"

# Verify stats are visible
- assertVisible: "Available Schemes"
- assertVisible: "Enrolled"
- assertVisible: "Pending"

# ===== PHASE 4: VIEW SCHEME DETAILS =====
# Tap on first scheme card
- tapOn:
    id: "scheme-card-1"

- waitForAnimationToEnd

# Verify scheme detail screen
- assertVisible: "Agricultural Input Subsidy"
- assertVisible: "SUBSIDY"
- assertVisible: "Benefit Type"
- assertVisible: "Benefit Amount"
- assertVisible: "Application Deadline"

# ===== PHASE 5: CHECK ELIGIBILITY =====
# Tap Check Eligibility button
- tapOn:
    id: "check-eligibility-button"

# Wait for assessment to complete
- extendedWaitUntil:
    visible: "Eligibility Assessment"
    timeout: 10000

# Verify assessment results
- assertVisible: "Eligibility Score"
- assertVisible: "Risk Level"
- assertVisible: "You are eligible for this scheme"

# ===== PHASE 6: VERIFY RULE RESULTS =====
# Scroll to see eligibility criteria
- swipe:
    start: "50%,80%"
    end: "50%,30%"
- waitForAnimationToEnd

- assertVisible: "Eligibility Criteria"

# Scroll to see all rules
- swipe:
    start: "50%,80%"
    end: "50%,30%"
- waitForAnimationToEnd

# ===== PHASE 7: TEST COMPLETE =====
# The eligibility assessment flow has been successfully tested:
# - Navigated to eligibility list
# - Viewed scheme details
# - Checked eligibility
# - Verified assessment results with score, risk level, and criteria

# Scroll back to top to verify we can see scheme info
- swipe:
    start: "50%,30%"
    end: "50%,80%"
- swipe:
    start: "50%,30%"
    end: "50%,80%"
- waitForAnimationToEnd

# Verify we're still on the scheme detail with assessment
- assertVisible: "Agricultural Input Subsidy"
- assertVisible: "Eligibility Assessment"
